/*** Generated by streamline 0.10.10 (callbacks) - DO NOT EDIT ***/ var __rt=require('streamline/lib/callbacks/runtime').runtime(__filename, false),__func=__rt.__func,__cb=__rt.__cb,__trap=__rt.__trap,__catch=__rt.__catch,__tryCatch=__rt.__tryCatch,__construct=__rt.__construct; (function main(_) { var __this = this; var __frame = { name: "main", line: 1 }; return __func(_, this, arguments, main, 0, __frame, function __$main() {












































































































































































    return (function ___closure(_) { var ORM, dirty, e, err, fs, models, ok, oracleConnectData, orm, rows, util, _ref; util = require("util"); fs = require("fs"); global.con = function(v) { return util.puts(util.inspect(v)); }; global.stack = function(err) { util.puts(("__" + err.message)); return util.puts(err.stack); }; oracleConnectData = JSON.parse((fs.readFileSync((__dirname + "/../testDB.json"))).toString("utf8")); ORM = require("oracle-orm"); return (function ___(__then) { (function ___(_) { __tryCatch(_, function __$___closure() { return __construct(ORM, 1)(oracleConnectData, __cb(_, __frame, NaN, NaN, function ___(__0, __25) { orm = __25; return orm.execute("CREATE TABLE PERSON (AAA NUMBER, BBB VARCHAR2(50), CCC VARCHAR2(100))", [], __cb(_, __frame, 22, 8, function __$___closure() { return orm.execute((("ALTER TABLE \"" + oracleConnectData.user) + "\".\"PERSON\" ADD CONSTRAINT PK_PERSON PRIMARY KEY(\"AAA\",\"CCC\")"), [], __cb(_, __frame, 23, 8, function __$___closure() { return orm.getModels(__cb(_, __frame, 24, 17, function ___(__0, __26) { models = __26; return (function __$___closure(_) { return models.PERSON.count(__cb(_, __frame, 25, 18, function ___(__0, __2) { var __1 = (__2 === 0); var __3 = __1; return (function __$___closure(__then) { if (__3) { var __4 = __1; return _(null, __4); } else { __then(); } ; })(function __$___closure() { return (function ___closure(_) { return _(new Error("1")); })(__cb(_, __frame, 25, 36, _, true)); }); }, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return models.PERSON.add({ aaa: 10, bbb: "abc", ccc: "1" }, __cb(_, __frame, 28, 18, function __$___closure() { return models.PERSON.add({ aaa: 20, bbb: "xyz", ccc: "2" }, __cb(_, __frame, 33, 18, function __$___closure() { return models.PERSON.add({ aaa: 30, bbb: "def", ccc: "3" }, __cb(_, __frame, 38, 18, function __$___closure() { return models.PERSON.add({ aaa: 40, bbb: "def", ccc: "4" }, __cb(_, __frame, 43, 18, function __$___closure() { return models.PERSON.add({ aaa: 50, ccc: "5" }, __cb(_, __frame, 48, 18, function __$___closure() { return (function __$___closure(_) { return (models.PERSON.count(__cb(_, __frame, 52, 19, function ___(__0, __3) { var __2 = (__3 === 5); var __4 = __2; return (function __$___closure(__then) { if (__4) { var __5 = __2; return _(null, __5); } else { __then(); } ; })(function __$___closure() { return (function ___closure(_) { return _(new Error("2")); })(__cb(_, __frame, 52, 38, _, true)); }); }, true))); })(__cb(_, __frame, 0, 7, function __$___closure() { return models.PERSON.all(__cb(_, __frame, 55, 25, function ___(__0, __27) { rows = __27; return (function __$___closure(_) { var __3 = (rows.length === 5); if (__3) { return _(null, __3); } ; return (function ___closure(_) { return _(new Error("3")); })(__cb(_, __frame, 56, 25, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return models.PERSON.get({ aaa: ">35" }, ["AAA ASC",], __cb(_, __frame, 59, 25, function ___(__0, __28) { rows = __28; return (function __$___closure(_) { var __4 = (rows.length === 2); if (__4) { return _(null, __4); } ; return (function ___closure(_) { return _(new Error("4")); })(__cb(_, __frame, 62, 25, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __5 = ((((((_ref = rows[0].connection) != null) ? _ref.execute : void 0)) != null)); if (__5) { return _(null, __5); } ; return (function ___closure(_) { return _(new Error("5")); })(__cb(_, __frame, 65, 79, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __6 = (rows[0].table.name === "PERSON"); if (__6) { return _(null, __6); } ; return (function ___closure(_) { return _(new Error("6")); })(__cb(_, __frame, 68, 39, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __7 = ((rows[0].data.AAA === 40) && (rows[0].data.BBB === "def")); if (__7) { return _(null, __7); } ; return (function ___closure(_) { return _(new Error("7")); })(__cb(_, __frame, 71, 61, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __8 = ((rows[1].data.AAA === 50) && (rows[1].data.BBB === null)); if (__8) { return _(null, __8); } ; return (function ___closure(_) { return _(new Error("8")); })(__cb(_, __frame, 74, 60, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return models.PERSON.update({ aaa: -100 }, { bbb: "='abc'" }, __cb(_, __frame, 77, 18, function __$___closure() { return models.PERSON.get({ }, ["CCC ASC",], __cb(_, __frame, 82, 25, function ___(__0, __29) { rows = __29; return (function __$___closure(_) { var __9 = (rows[0].data.AAA === -100); if (__9) { return _(null, __9); } ; return (function ___closure(_) { return _(new Error("9")); })(__cb(_, __frame, 83, 33, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __10 = (rows[0].deleted === false); if (__10) { return _(null, __10); } ; return (function ___closure(_) { return _(new Error("10")); })(__cb(_, __frame, 86, 33, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return rows[0].del(__cb(_, __frame, 89, 12, function __$___closure() { return (function __$___closure(_) { var __11 = (rows[0].deleted === true); if (__11) { return _(null, __11); } ; return (function ___closure(_) { return _(new Error("11")); })(__cb(_, __frame, 90, 32, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function ___(__then) { (function ___(_) { __tryCatch(_, function __$___closure() { return (function ___(__then) { (function ___(_) { __tryCatch(_, function __$___closure() { ok = false; return rows[0].del(__cb(_, __frame, 95, 14, __then, true)); }); })(function ___(_error, __result) { __catch(function __$___closure() { if (_error) { e = _error; ok = true; __then(); } else { _(null, __result); } ; }); }); })(function ___() { __tryCatch(_, function __$___closure() { _(null, null, true); }); }); }); })(function ___(__e, __r, __cont) { (function ___(__then) { __tryCatch(_, function __$___closure() { if (!ok) { return _(new Error("11.1")); } ; __then(); }); })(function ___() { __tryCatch(_, function ___() { if (__cont) { __then(); } else { _(__e, __r); }; }); }); }); })(function ___() { __tryCatch(_, function __$___closure() { return models.PERSON.all(__cb(_, __frame, 104, 25, function ___(__0, __30) { rows = __30; return (function __$___closure(_) { return (models.PERSON.count(__cb(_, __frame, 105, 19, function ___(__0, __13) { var __12 = (__13 === 4); var __14 = __12; return (function __$___closure(__then) { if (__14) { var __15 = __12; return _(null, __15); } else { __then(); } ; })(function __$___closure() { return (function ___closure(_) { return _(new Error("12")); })(__cb(_, __frame, 105, 38, _, true)); }); }, true))); })(__cb(_, __frame, 0, 7, function __$___closure() { return models.PERSON.get({ }, ["AAA ASC",], __cb(_, __frame, 108, 25, function ___(__0, __31) { rows = __31; return (function __$___closure(_) { var __13 = (rows[1].backdata.AAA === rows[1].data.AAA); if (__13) { return _(null, __13); } ; return (function ___closure(_) { return _(new Error("13")); })(__cb(_, __frame, 109, 49, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { rows[1].data.AAA++; dirty = rows[1].getDirty(); return (function __$___closure(_) { var __14 = (Object.keys(dirty).length === 1); if (__14) { return _(null, __14); } ; return (function ___closure(_) { return _(new Error("14")); })(__cb(_, __frame, 114, 39, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __15 = (rows[1].isDirty() === true); if (__15) { return _(null, __15); } ; return (function ___closure(_) { return _(new Error("14.1")); })(__cb(_, __frame, 117, 34, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __16 = (dirty.AAA === 31); if (__16) { return _(null, __16); } ; return (function ___closure(_) { return _(new Error("15")); })(__cb(_, __frame, 120, 24, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return rows[1].save(__cb(_, __frame, 123, 12, function __$___closure() { dirty = rows[1].getDirty(); return (function __$___closure(_) { var __17 = (Object.keys(dirty).length === 0); if (__17) { return _(null, __17); } ; return (function ___closure(_) { return _(new Error("16")); })(__cb(_, __frame, 125, 39, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __18 = (rows[1].isDirty() === false); if (__18) { return _(null, __18); } ; return (function ___closure(_) { return _(new Error("16.1")); })(__cb(_, __frame, 128, 35, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { rows[2].data.BBB = "xyz"; dirty = rows[2].getDirty(); return (function __$___closure(_) { var __19 = (Object.keys(dirty).length === 1); if (__19) { return _(null, __19); } ; return (function ___closure(_) { return _(new Error("17")); })(__cb(_, __frame, 133, 39, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __20 = (rows[2].isDirty() === true); if (__20) { return _(null, __20); } ; return (function ___closure(_) { return _(new Error("17.1")); })(__cb(_, __frame, 136, 34, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return rows[2].sync(__cb(_, __frame, 139, 12, function __$___closure() { return (function __$___closure(_) { var __21 = (rows[2].data.BBB === "def"); if (__21) { return _(null, __21); } ; return (function ___closure(_) { return _(new Error("18")); })(__cb(_, __frame, 140, 34, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { dirty = rows[2].getDirty(); return (function __$___closure(_) { var __22 = (Object.keys(dirty).length === 0); if (__22) { return _(null, __22); } ; return (function ___closure(_) { return _(new Error("19")); })(__cb(_, __frame, 144, 39, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return (function __$___closure(_) { var __23 = (rows[2].isDirty() === false); if (__23) { return _(null, __23); } ; return (function ___closure(_) { return _(new Error("19.1")); })(__cb(_, __frame, 147, 35, _, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return rows[2].save(__cb(_, __frame, 150, 12, function __$___closure() { return models.PERSON.empty(__cb(_, __frame, 151, 18, function __$___closure() { return (function __$___closure(_) { return models.PERSON.count(__cb(_, __frame, 152, 18, function ___(__0, __25) { var __24 = (__25 === 0); var __26 = __24; return (function __$___closure(__then) { if (__26) { var __27 = __24; return _(null, __27); } else { __then(); } ; })(function __$___closure() { return (function ___closure(_) { return _(new Error("20")); })(__cb(_, __frame, 152, 36, _, true)); }); }, true)); })(__cb(_, __frame, 0, 7, function __$___closure() { return orm.execute("DROP TABLE PERSON", [], __cb(_, __frame, 155, 8, function __$___closure() { return (function ___(__then) { (function ___(_) { __tryCatch(_, function __$___closure() { return (function ___(__then) { (function ___(_) { __tryCatch(_, function __$___closure() { ok = false; return models.PERSON.all(__cb(_, __frame, 158, 27, function ___(__0, __32) { rows = __32; __then(); }, true)); }); })(function ___(_error, __result) { __catch(function __$___closure() { if (_error) { e = _error; ok = true; __then(); } else { _(null, __result); } ; }); }); })(function ___() { __tryCatch(_, function __$___closure() { _(null, null, true); }); }); }); })(function ___(__e, __r, __cont) { (function ___(__then) { __tryCatch(_, function __$___closure() { if (!ok) { return _(new Error("21")); } ; __then(); }); })(function ___() { __tryCatch(_, function ___() { if (__cont) { __then(); } else { _(__e, __r); }; }); }); }); })(function ___() { __tryCatch(_, __then); }); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }); }); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }, true)); }); })(function ___(_error, __result) { __catch(function __$___closure() { if (_error) { err = _error; con(err); stack(err); __then(); } else { _(null, __result); } ; }); }); })(function ___() { __tryCatch(_, function __$___closure() { _(); }); }); })(_); });}).call(this, __trap);
